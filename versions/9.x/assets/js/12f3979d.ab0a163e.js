"use strict";(self.webpackChunkmongodb_memory_server_website=self.webpackChunkmongodb_memory_server_website||[]).push([[313],{3905:function(e,n,t){t.d(n,{Zo:function(){return p},kt:function(){return h}});var o=t(7294);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function a(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,o)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?a(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):a(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,o,r=function(e,n){if(null==e)return{};var t,o,r={},a=Object.keys(e);for(o=0;o<a.length;o++)t=a[o],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(o=0;o<a.length;o++)t=a[o],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var s=o.createContext({}),d=function(e){var n=o.useContext(s),t=n;return e&&(t="function"==typeof e?e(n):i(i({},n),e)),t},p=function(e){var n=d(e.components);return o.createElement(s.Provider,{value:n},e.children)},m="mdxType",u={inlineCode:"code",wrapper:function(e){var n=e.children;return o.createElement(o.Fragment,{},n)}},c=o.forwardRef((function(e,n){var t=e.components,r=e.mdxType,a=e.originalType,s=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),m=d(t),c=r,h=m["".concat(s,".").concat(c)]||m[c]||u[c]||a;return t?o.createElement(h,i(i({ref:n},p),{},{components:t})):o.createElement(h,i({ref:n},p))}));function h(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var a=t.length,i=new Array(a);i[0]=c;var l={};for(var s in n)hasOwnProperty.call(n,s)&&(l[s]=n[s]);l.originalType=e,l[m]="string"==typeof e?e:r,i[1]=l;for(var d=2;d<a;d++)i[d]=t[d];return o.createElement.apply(null,i)}return o.createElement.apply(null,t)}c.displayName="MDXCreateElement"},4318:function(e,n,t){t.r(n),t.d(n,{assets:function(){return p},contentTitle:function(){return s},default:function(){return h},frontMatter:function(){return l},metadata:function(){return d},toc:function(){return m}});var o=t(7462),r=t(3366),a=(t(7294),t(3905)),i=["components"],l={id:"migrate9",title:"Migrate to version 9.0.0"},s=void 0,d={unversionedId:"guides/migration/migrate9",id:"guides/migration/migrate9",title:"Migrate to version 9.0.0",description:"Here are the Important changes made for 9.0.0",source:"@site/../docs/guides/migration/migrate9.md",sourceDirName:"guides/migration",slug:"/guides/migration/migrate9",permalink:"/mongodb-memory-server/versions/9.x/docs/guides/migration/migrate9",draft:!1,editUrl:"https://github.com/typegoose/mongodb-memory-server/edit/master/docs/../docs/guides/migration/migrate9.md",tags:[],version:"current",frontMatter:{id:"migrate9",title:"Migrate to version 9.0.0"},sidebar:"guides",previous:{title:"Common Issues",permalink:"/mongodb-memory-server/versions/9.x/docs/guides/common-issues"},next:{title:"Migrate to version 8.0.0",permalink:"/mongodb-memory-server/versions/9.x/docs/guides/migration/migrate8"}},p={},m=[{value:"Breaking Changes",id:"breaking-changes",level:2},{value:"Minimal NodeJS version is now <code>14</code>",id:"minimal-nodejs-version-is-now-14",level:3},{value:"Mongodb Driver Version upgraded to 5.x",id:"mongodb-driver-version-upgraded-to-5x",level:3},{value:"Default binary version is now 6.x",id:"default-binary-version-is-now-6x",level:3},{value:"Removed platform translations",id:"removed-platform-translations",level:3},{value:"Removed architectures",id:"removed-architectures",level:3},{value:"MongoMemoryServer <code>instance.auth</code> option is now ignored",id:"mongomemoryserver-instanceauth-option-is-now-ignored",level:3},{value:"<code>AutomaticAuth</code> changes",id:"automaticauth-changes",level:3},{value:"MongoMemoryServer and MongoReplSet <code>.cleanup(boolean)</code> and <code>.stop(boolean)</code> have been removed",id:"mongomemoryserver-and-mongoreplset-cleanupboolean-and-stopboolean-have-been-removed",level:3},{value:"<code>MD5_CHECK</code> is now enabled by default",id:"md5_check-is-now-enabled-by-default",level:3},{value:"Merged Error types",id:"merged-error-types",level:3},{value:"Removed Storage engine <code>devnull</code> and <code>mmapv1</code>",id:"removed-storage-engine-devnull-and-mmapv1",level:3},{value:"Linux fallback binary has been removed",id:"linux-fallback-binary-has-been-removed",level:3},{value:"Ubuntu fallback year has been updated",id:"ubuntu-fallback-year-has-been-updated",level:3},{value:"Non-Breaking changes / Additions",id:"non-breaking-changes--additions",level:2},{value:"Compiler target is now <code>es2019</code>",id:"compiler-target-is-now-es2019",level:3},{value:"Crypto function have been changed to use nodejs internals",id:"crypto-function-have-been-changed-to-use-nodejs-internals",level:2},{value:"Binary childprocess is now also <code>.unref()</code>",id:"binary-childprocess-is-now-also-unref",level:2},{value:"The port testing package has been replaced",id:"the-port-testing-package-has-been-replaced",level:2},{value:"Mongodb version 7.0.0 is now supported",id:"mongodb-version-700-is-now-supported",level:2}],u={toc:m},c="wrapper";function h(e){var n=e.components,t=(0,r.Z)(e,i);return(0,a.kt)(c,(0,o.Z)({},u,t,{components:n,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"Here are the Important changes made for 9.0.0"),(0,a.kt)("admonition",{title:"Important, Read this first",type:"caution"},(0,a.kt)("p",{parentName:"admonition"},"This Guide is written for migration from version ",(0,a.kt)("inlineCode",{parentName:"p"},"8.16.0")," to ",(0,a.kt)("inlineCode",{parentName:"p"},"9.0.0"),", for versions ",(0,a.kt)("inlineCode",{parentName:"p"},">9.0.0 <10.0.0"),", please consult the ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/typegoose/mongodb-memory-server/blob/master/CHANGELOG.md"},"CHANGELOG"))),(0,a.kt)("h2",{id:"breaking-changes"},"Breaking Changes"),(0,a.kt)("h3",{id:"minimal-nodejs-version-is-now-14"},"Minimal NodeJS version is now ",(0,a.kt)("inlineCode",{parentName:"h3"},"14")),(0,a.kt)("p",null,"With 9.0.0 the minimal nodejs required is ",(0,a.kt)("inlineCode",{parentName:"p"},"14.20.1"),"."),(0,a.kt)("h3",{id:"mongodb-driver-version-upgraded-to-5x"},"Mongodb Driver Version upgraded to 5.x"),(0,a.kt)("p",null,"The used MongoDB Driver version is now ",(0,a.kt)("inlineCode",{parentName:"p"},"5.9.0"),"."),(0,a.kt)("h3",{id:"default-binary-version-is-now-6x"},"Default binary version is now 6.x"),(0,a.kt)("p",null,"The default binary version has been upgraded from ",(0,a.kt)("inlineCode",{parentName:"p"},"5.0.x")," to ",(0,a.kt)("inlineCode",{parentName:"p"},"6.0.x"),". For more specifics see ",(0,a.kt)("a",{parentName:"p",href:"/mongodb-memory-server/versions/9.x/docs/guides/mongodb-server-versions"},"mongodb-server-versions"),"."),(0,a.kt)("h3",{id:"removed-platform-translations"},"Removed platform translations"),(0,a.kt)("p",null,"Some platform translations have been removed, because they are either not needed anymore or werent properly supported in the first place:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"sunos")," -> ",(0,a.kt)("inlineCode",{parentName:"li"},"linux")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"elementary OS")," -> ",(0,a.kt)("inlineCode",{parentName:"li"},"linux"))),(0,a.kt)("h3",{id:"removed-architectures"},"Removed architectures"),(0,a.kt)("p",null,"Some architectures were removed because they were not being build by mongodb anymore and support in mongodb-memory-server has been largely untested:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"ia32")," -> ",(0,a.kt)("inlineCode",{parentName:"li"},"i686")," / ",(0,a.kt)("inlineCode",{parentName:"li"},"i386"))),(0,a.kt)("h3",{id:"mongomemoryserver-instanceauth-option-is-now-ignored"},"MongoMemoryServer ",(0,a.kt)("inlineCode",{parentName:"h3"},"instance.auth")," option is now ignored"),(0,a.kt)("p",null,"With 9.0.0 the option ",(0,a.kt)("inlineCode",{parentName:"p"},"instance.auth")," option is going to be ignored, because its set via the (top-level) ",(0,a.kt)("inlineCode",{parentName:"p"},"auth")," option directly."),(0,a.kt)("p",null,"Example:"),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"new MongoMemoryServer({ instance: { auth: true } })")," is going to be ignored, use ",(0,a.kt)("inlineCode",{parentName:"p"},"new MongoMemoryServer({ auth: { enable: true } })")),(0,a.kt)("h3",{id:"automaticauth-changes"},(0,a.kt)("inlineCode",{parentName:"h3"},"AutomaticAuth")," changes"),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"AutomaticAuth")," has been changed to ",(0,a.kt)("strong",{parentName:"p"},"not")," be enabled anymore by just having a empty object. Also property ",(0,a.kt)("inlineCode",{parentName:"p"},"disable")," has been removed and ",(0,a.kt)("inlineCode",{parentName:"p"},"enable")," has been added."),(0,a.kt)("p",null,"Replace ",(0,a.kt)("inlineCode",{parentName:"p"},"auth: {}")," with ",(0,a.kt)("inlineCode",{parentName:"p"},"auth: { enable: true }"),".",(0,a.kt)("br",{parentName:"p"}),"\n","Replace ",(0,a.kt)("inlineCode",{parentName:"p"},"auth: { disable: true }")," with ",(0,a.kt)("inlineCode",{parentName:"p"},"auth: { enable: false }"),".",(0,a.kt)("br",{parentName:"p"}),"\n","Replace ",(0,a.kt)("inlineCode",{parentName:"p"},"auth: { disable: false }")," with ",(0,a.kt)("inlineCode",{parentName:"p"},"auth: { enable: true }"),".  "),(0,a.kt)("h3",{id:"mongomemoryserver-and-mongoreplset-cleanupboolean-and-stopboolean-have-been-removed"},"MongoMemoryServer and MongoReplSet ",(0,a.kt)("inlineCode",{parentName:"h3"},".cleanup(boolean)")," and ",(0,a.kt)("inlineCode",{parentName:"h3"},".stop(boolean)")," have been removed"),(0,a.kt)("p",null,"Previously ",(0,a.kt)("inlineCode",{parentName:"p"},"boolean")," was the only option for the ",(0,a.kt)("inlineCode",{parentName:"p"},".cleanup")," and ",(0,a.kt)("inlineCode",{parentName:"p"},".stop")," function, but they behaved differently between those 2 function and were replaced with ",(0,a.kt)("inlineCode",{parentName:"p"},"Cleanup")," object-options and now have been completely removed."),(0,a.kt)("p",null,"Replace ",(0,a.kt)("inlineCode",{parentName:"p"},".stop(true)")," with ",(0,a.kt)("inlineCode",{parentName:"p"},".stop({ doCleanup: true })"),".",(0,a.kt)("br",{parentName:"p"}),"\n","Replace ",(0,a.kt)("inlineCode",{parentName:"p"},".cleanup(true)")," with ",(0,a.kt)("inlineCode",{parentName:"p"},".stop({ doCleanup: true, force: true })"),".  "),(0,a.kt)("p",null,"Default is still for both ",(0,a.kt)("inlineCode",{parentName:"p"},"{ doCleanup: true, force: false }"),"."),(0,a.kt)("h3",{id:"md5_check-is-now-enabled-by-default"},(0,a.kt)("inlineCode",{parentName:"h3"},"MD5_CHECK")," is now enabled by default"),(0,a.kt)("p",null,"The config option ",(0,a.kt)("a",{parentName:"p",href:"/mongodb-memory-server/versions/9.x/docs/api/config-options#md5_check"},(0,a.kt)("inlineCode",{parentName:"a"},"MD5_CHECK"))," has been enabled by default now, resulting in always comparing the downloaded archive with a md5 after a download."),(0,a.kt)("h3",{id:"merged-error-types"},"Merged Error types"),(0,a.kt)("p",null,"Some error classes have been merged:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"EnsureInstanceError")," & ",(0,a.kt)("inlineCode",{parentName:"li"},"InstanceInfoError")," -> ",(0,a.kt)("inlineCode",{parentName:"li"},"InstanceInfoError")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"NoSystemBinaryFoundError")," & ",(0,a.kt)("inlineCode",{parentName:"li"},"BinaryNotFoundError")," -> ",(0,a.kt)("inlineCode",{parentName:"li"},"BinaryNotFoundError"))),(0,a.kt)("h3",{id:"removed-storage-engine-devnull-and-mmapv1"},"Removed Storage engine ",(0,a.kt)("inlineCode",{parentName:"h3"},"devnull")," and ",(0,a.kt)("inlineCode",{parentName:"h3"},"mmapv1")),(0,a.kt)("p",null,"Storage Engines ",(0,a.kt)("inlineCode",{parentName:"p"},"devnull")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"mmapv1")," have been removed because they are not supported in newer versions of mongodb anymore, ",(0,a.kt)("inlineCode",{parentName:"p"},"wiredTiger")," should be used instead."),(0,a.kt)("h3",{id:"linux-fallback-binary-has-been-removed"},"Linux fallback binary has been removed"),(0,a.kt)("p",null,"Previously there was a code-path for a fallback linux binary, but this has been removed because mongodb has stopped shipping generic linux binaries since versions after 4.0."),(0,a.kt)("p",null,"If a fallback is still required, try to use the ubuntu binary via ",(0,a.kt)("a",{parentName:"p",href:"/mongodb-memory-server/versions/9.x/docs/api/config-options#distro"},"Config Options ",(0,a.kt)("inlineCode",{parentName:"a"},"DISTRO")),"."),(0,a.kt)("h3",{id:"ubuntu-fallback-year-has-been-updated"},"Ubuntu fallback year has been updated"),(0,a.kt)("p",null,"The ubuntu fallback year has been updated to ",(0,a.kt)("inlineCode",{parentName:"p"},"22"),", instead of the previous ",(0,a.kt)("inlineCode",{parentName:"p"},"14"),", because newer versions of mongodb dont ship for any EOL ubuntu version anymore."),(0,a.kt)("p",null,"This fallback is only used if the ubuntu year could not be parsed from the os-file.",(0,a.kt)("br",{parentName:"p"}),"\n","This can also be overwritten with ",(0,a.kt)("a",{parentName:"p",href:"/mongodb-memory-server/versions/9.x/docs/api/config-options#distro"},"Config Option ",(0,a.kt)("inlineCode",{parentName:"a"},"DISTRO")),"."),(0,a.kt)("h2",{id:"non-breaking-changes--additions"},"Non-Breaking changes / Additions"),(0,a.kt)("h3",{id:"compiler-target-is-now-es2019"},"Compiler target is now ",(0,a.kt)("inlineCode",{parentName:"h3"},"es2019")),(0,a.kt)("p",null,"The tsconfig ",(0,a.kt)("inlineCode",{parentName:"p"},"target")," option has been updated to ",(0,a.kt)("inlineCode",{parentName:"p"},"es2019"),", which will result in less polyfills.\nThis should be a non-breaking change"),(0,a.kt)("h2",{id:"crypto-function-have-been-changed-to-use-nodejs-internals"},"Crypto function have been changed to use nodejs internals"),(0,a.kt)("p",null,"Crypto functions like for the md5 check and uuidv4 generation have been moved to use the ",(0,a.kt)("inlineCode",{parentName:"p"},"node:crypto")," support, resulting in dropping 2 dependencies."),(0,a.kt)("p",null,"Dropped dependencies are ",(0,a.kt)("inlineCode",{parentName:"p"},"md5-file")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"uuid"),"."),(0,a.kt)("h2",{id:"binary-childprocess-is-now-also-unref"},"Binary childprocess is now also ",(0,a.kt)("inlineCode",{parentName:"h2"},".unref()")),(0,a.kt)("p",null,"The Mongodb Binary childprocess is now also ",(0,a.kt)("inlineCode",{parentName:"p"},".unref()"),", like the killer process has been for some time."),(0,a.kt)("p",null,"This ",(0,a.kt)("em",{parentName:"p"},"should")," help with non-closed instances not exiting the nodejs process."),(0,a.kt)("h2",{id:"the-port-testing-package-has-been-replaced"},"The port testing package has been replaced"),(0,a.kt)("p",null,"Previously MMS used ",(0,a.kt)("inlineCode",{parentName:"p"},"get-port"),", but it caused some big memory-leakage across big projects, so it has been replaced with one that uses less maps."),(0,a.kt)("p",null,"It also has been replaced because newer versions were ESM only, but we couldnt switch to ESM yet (and using ESM in CommonJS is not a great experience)"),(0,a.kt)("h2",{id:"mongodb-version-700-is-now-supported"},"Mongodb version 7.0.0 is now supported"),(0,a.kt)("p",null,"Mongob version ",(0,a.kt)("inlineCode",{parentName:"p"},"7.0.0")," removed storage engine ",(0,a.kt)("inlineCode",{parentName:"p"},"ephemeralForTest"),", with mongodb-memory-server 9.0.0 storage engine ",(0,a.kt)("inlineCode",{parentName:"p"},"wiredTiger")," is the default for binary versions ",(0,a.kt)("inlineCode",{parentName:"p"},"7.0.0")," and higher.\nOlder versions (before ",(0,a.kt)("inlineCode",{parentName:"p"},"7.0.0"),") will still continue to use ",(0,a.kt)("inlineCode",{parentName:"p"},"ephemeralForTest")," by default."),(0,a.kt)("admonition",{type:"info"},(0,a.kt)("p",{parentName:"admonition"},"The version used for the decision is the version provided via the resolved ",(0,a.kt)("a",{parentName:"p",href:"/mongodb-memory-server/versions/9.x/docs/api/config-options#version"},(0,a.kt)("inlineCode",{parentName:"a"},"VERSION"))," config option.",(0,a.kt)("br",{parentName:"p"}),"\n","This mean it needs to match the version the system binary is (a warning is printed if they are not the same)."),(0,a.kt)("p",{parentName:"admonition"},"If the option is unset, the default version will be used, which is likely not correct for the system binary."),(0,a.kt)("p",{parentName:"admonition"},"If the decision should not be automatic, the storage engine can be explicitly defined as a instance option.")),(0,a.kt)("p",null,"It is recommended to run those instances with a db path which is equivalent to ",(0,a.kt)("a",{parentName:"p",href:"https://wiki.archlinux.org/title/tmpfs"},(0,a.kt)("inlineCode",{parentName:"a"},"tmpfs")),"."))}h.isMDXComponent=!0}}]);